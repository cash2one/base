Index: parkserver/.git/index
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream
Index: parkserver/.idea/misc.xml
===================================================================
--- parkserver/.idea/misc.xml	(revision 328)
+++ parkserver/.idea/misc.xml	(working copy)
@@ -10,7 +10,7 @@
     <ConfirmationsSetting value="0" id="Add" />
     <ConfirmationsSetting value="0" id="Remove" />
   </component>
-  <component name="ProjectRootManager" version="2" project-jdk-name="Python 3.4.3 (C:\Python34\python.exe) (1)" project-jdk-type="Python SDK" />
+  <component name="ProjectRootManager" version="2" project-jdk-name="Python 3.4.4 (/System/Library/Frameworks/Python.framework/Versions/3.4/bin/python3.4)" project-jdk-type="Python SDK" />
   <component name="SvnBranchConfigurationManager">
     <option name="mySupportsUserInfoFilter" value="true" />
   </component>
Index: parkserver/.idea/parkserver.iml
===================================================================
--- parkserver/.idea/parkserver.iml	(revision 328)
+++ parkserver/.idea/parkserver.iml	(working copy)
@@ -2,7 +2,7 @@
 <module type="PYTHON_MODULE" version="4">
   <component name="NewModuleRootManager">
     <content url="file://$MODULE_DIR$" />
-    <orderEntry type="jdk" jdkName="Python 3.4.3 (C:\Python34\python.exe) (1)" jdkType="Python SDK" />
+    <orderEntry type="jdk" jdkName="Python 3.4.4 (/System/Library/Frameworks/Python.framework/Versions/3.4/bin/python3.4)" jdkType="Python SDK" />
     <orderEntry type="sourceFolder" forTests="false" />
   </component>
   <component name="PyDocumentationSettings">
Index: parkserver/.idea/workspace.xml
===================================================================
--- parkserver/.idea/workspace.xml	(revision 328)
+++ parkserver/.idea/workspace.xml	(working copy)
@@ -1,7 +1,14 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <project version="4">
   <component name="ChangeListManager">
-    <list default="true" readonly="true" id="5d6d8b97-c4e8-4b9e-8b00-024b0cedcc91" name="Default" comment="" />
+    <list default="true" readonly="true" id="5d6d8b97-c4e8-4b9e-8b00-024b0cedcc91" name="Default" comment="">
+      <change type="MODIFICATION" beforePath="$PROJECT_DIR$/.idea/misc.xml" afterPath="$PROJECT_DIR$/.idea/misc.xml" />
+      <change type="MODIFICATION" beforePath="$PROJECT_DIR$/.idea/parkserver.iml" afterPath="$PROJECT_DIR$/.idea/parkserver.iml" />
+      <change type="MODIFICATION" beforePath="$PROJECT_DIR$/.idea/workspace.xml" afterPath="$PROJECT_DIR$/.idea/workspace.xml" />
+      <change type="MODIFICATION" beforePath="$PROJECT_DIR$/app/models.py" afterPath="$PROJECT_DIR$/app/models.py" />
+      <change type="MODIFICATION" beforePath="$PROJECT_DIR$/app/route.py" afterPath="$PROJECT_DIR$/app/route.py" />
+      <change type="MODIFICATION" beforePath="$PROJECT_DIR$/app/views.py" afterPath="$PROJECT_DIR$/app/views.py" />
+    </list>
     <ignored path="parkserver.iws" />
     <ignored path=".idea/workspace.xml" />
     <ignored path=".idea/dataSources.local.xml" />
@@ -12,7 +19,6 @@
     <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
     <option name="LAST_RESOLUTION" value="IGNORE" />
   </component>
-  <component name="ChangesViewManager" flattened_view="true" show_ignored="false" />
   <component name="CoverageDataManager">
     <SUITE FILE_PATH="coverage/parkserver$parkserver.coverage" NAME="parkserver Coverage Results" MODIFIED="1476006201691" SOURCE_PROVIDER="com.intellij.coverage.DefaultCoverageFileProvider" RUNNER="coverage.py" COVERAGE_BY_TEST_ENABLED="true" COVERAGE_TRACING_ENABLED="false" WORKING_DIRECTORY="$PROJECT_DIR$" />
   </component>
@@ -25,11 +31,21 @@
   </component>
   <component name="FileEditorManager">
     <leaf SIDE_TABS_SIZE_LIMIT_KEY="300">
+<<<<<<< .mine
+      <file leaf-file-name="dashboard.html" pinned="false" current-in-tab="false">
+        <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/dashboard.html">
+=======
       <file leaf-file-name="views.py" pinned="false" current-in-tab="false">
         <entry file="file://$PROJECT_DIR$/app/views.py">
+>>>>>>> .r325
           <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+            <state relative-caret-position="405">
+              <caret line="27" column="0" selection-start-line="27" selection-start-column="0" selection-end-line="27" selection-end-column="0" />
+=======
             <state relative-caret-position="604">
               <caret line="552" column="63" selection-start-line="552" selection-start-column="63" selection-end-line="552" selection-end-column="63" />
+>>>>>>> .r325
               <folding />
             </state>
           </provider>
@@ -38,65 +54,134 @@
       <file leaf-file-name="retrying.py" pinned="false" current-in-tab="false">
         <entry file="file://$PROJECT_DIR$/app/retrying.py">
           <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+            <state relative-caret-position="231">
+              <caret line="430" column="14" selection-start-line="430" selection-start-column="12" selection-end-line="430" selection-end-column="14" />
+              <folding>
+                <element signature="e#0#11#0" expanded="true" />
+              </folding>
+=======
             <state relative-caret-position="4427">
               <caret line="237" column="34" selection-start-line="237" selection-start-column="34" selection-end-line="237" selection-end-column="34" />
               <folding />
+>>>>>>> .r325
             </state>
           </provider>
         </entry>
       </file>
+<<<<<<< .mine
+      <file leaf-file-name="master.html" pinned="false" current-in-tab="false">
+        <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/master.html">
+=======
       <file leaf-file-name="view.py" pinned="false" current-in-tab="false">
         <entry file="file://C:/Python34/Lib/site-packages/flask_admin/contrib/mongoengine/view.py">
+>>>>>>> .r325
           <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+            <state relative-caret-position="0">
+              <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+=======
             <state relative-caret-position="6498">
               <caret line="365" column="65" selection-start-line="365" selection-start-column="65" selection-end-line="365" selection-end-column="65" />
+>>>>>>> .r325
               <folding />
             </state>
           </provider>
         </entry>
       </file>
+<<<<<<< .mine
+      <file leaf-file-name="nav.html" pinned="false" current-in-tab="false">
+        <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/nav.html">
+=======
       <file leaf-file-name="models.py" pinned="false" current-in-tab="false">
         <entry file="file://$PROJECT_DIR$/app/models.py">
+>>>>>>> .r325
           <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+            <state relative-caret-position="0">
+              <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+=======
             <state relative-caret-position="817">
               <caret line="48" column="6" selection-start-line="48" selection-start-column="6" selection-end-line="48" selection-end-column="6" />
+>>>>>>> .r325
               <folding />
             </state>
           </provider>
         </entry>
       </file>
+<<<<<<< .mine
+      <file leaf-file-name="redirect.html" pinned="false" current-in-tab="false">
+        <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/redirect.html">
+=======
       <file leaf-file-name="default.py" pinned="false" current-in-tab="true">
         <entry file="file://$PROJECT_DIR$/config/default.py">
+>>>>>>> .r325
           <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+            <state relative-caret-position="135">
+              <caret line="9" column="7" selection-start-line="9" selection-start-column="7" selection-end-line="9" selection-end-column="7" />
+=======
             <state relative-caret-position="358">
               <caret line="102" column="11" selection-start-line="102" selection-start-column="11" selection-end-line="102" selection-end-column="11" />
+>>>>>>> .r325
               <folding />
             </state>
           </provider>
         </entry>
       </file>
+<<<<<<< .mine
+      <file leaf-file-name="views.py" pinned="false" current-in-tab="true">
+        <entry file="file://$PROJECT_DIR$/app/views.py">
+=======
       <file leaf-file-name="WechatTools.py" pinned="false" current-in-tab="false">
         <entry file="file://$PROJECT_DIR$/app/WechatTools.py">
+>>>>>>> .r325
           <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+            <state relative-caret-position="1035">
+              <caret line="1920" column="29" selection-start-line="1920" selection-start-column="29" selection-end-line="1920" selection-end-column="29" />
+=======
             <state relative-caret-position="8569">
               <caret line="451" column="50" selection-start-line="451" selection-start-column="50" selection-end-line="451" selection-end-column="50" />
+>>>>>>> .r325
               <folding>
+<<<<<<< .mine
+                <element signature="e#0#10#0" expanded="true" />
+                <element signature="e#21092#25941#0" expanded="false" />
+                <element signature="e#32297#50163#0" expanded="false" />
+=======
                 <element signature="e#0#14#0" expanded="true" />
+>>>>>>> .r325
               </folding>
             </state>
           </provider>
         </entry>
       </file>
+<<<<<<< .mine
       <file leaf-file-name="__init__.py" pinned="false" current-in-tab="false">
+        <entry file="file://$PROJECT_DIR$/app/__init__.py">
+=======
+      <file leaf-file-name="__init__.py" pinned="false" current-in-tab="false">
         <entry file="file://$PROJECT_DIR$/config/__init__.py">
+>>>>>>> .r325
           <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+            <state relative-caret-position="213">
+              <caret line="81" column="13" selection-start-line="81" selection-start-column="13" selection-end-line="81" selection-end-column="13" />
+              <folding>
+                <element signature="e#0#23#0" expanded="true" />
+              </folding>
+=======
             <state relative-caret-position="380">
               <caret line="20" column="21" selection-start-line="20" selection-start-column="14" selection-end-line="20" selection-end-column="21" />
               <folding />
+>>>>>>> .r325
             </state>
           </provider>
         </entry>
       </file>
+<<<<<<< .mine
+=======
       <file leaf-file-name="OleFileIO.py" pinned="false" current-in-tab="false">
         <entry file="file://C:/Python34/Lib/site-packages/PIL/OleFileIO.py">
           <provider selected="true" editor-type-id="text-editor">
@@ -127,6 +212,7 @@
           </provider>
         </entry>
       </file>
+>>>>>>> .r325
     </leaf>
   </component>
   <component name="FileTemplateManagerImpl">
@@ -144,7 +230,6 @@
         <option value="$PROJECT_DIR$/app/templates/sb-admin/pages/dashboard.html" />
         <option value="$PROJECT_DIR$/app/tasks.py" />
         <option value="$PROJECT_DIR$/app/logging.config.py" />
-        <option value="$PROJECT_DIR$/app/__init__.py" />
         <option value="$PROJECT_DIR$/manage.py" />
         <option value="$PROJECT_DIR$/app/route.py" />
         <option value="$PROJECT_DIR$/app/myAli.py" />
@@ -154,8 +239,21 @@
         <option value="$PROJECT_DIR$/app/BarCodeObject.py" />
         <option value="$PROJECT_DIR$/app/models.py" />
         <option value="$PROJECT_DIR$/app/WechatTools.py" />
+<<<<<<< .mine
+        <option value="$PROJECT_DIR$/app/couponrule.py" />
+        <option value="$PROJECT_DIR$/app/UserLogin.py" />
+        <option value="$PROJECT_DIR$/app/route.py" />
+        <option value="$PROJECT_DIR$/app/__init__.py" />
+        <option value="$PROJECT_DIR$/app/test/coupontest.py" />
+        <option value="$PROJECT_DIR$/app/models.py" />
+=======
+>>>>>>> .r325
+        <option value="$PROJECT_DIR$/app/CouponDiscount.py" />
         <option value="$PROJECT_DIR$/app/views.py" />
+<<<<<<< .mine
+=======
         <option value="$PROJECT_DIR$/config/default.py" />
+>>>>>>> .r325
       </list>
     </option>
   </component>
@@ -166,10 +264,10 @@
     <sorting>DEFINITION_ORDER</sorting>
   </component>
   <component name="ProjectFrameBounds">
-    <option name="x" value="-8" />
-    <option name="y" value="-8" />
-    <option name="width" value="1382" />
-    <option name="height" value="744" />
+    <option name="x" value="4" />
+    <option name="y" value="26" />
+    <option name="width" value="1420" />
+    <option name="height" value="817" />
   </component>
   <component name="ProjectInspectionProfilesVisibleTreeState">
     <entry key="Project Default">
@@ -215,7 +313,6 @@
       <foldersAlwaysOnTop value="true" />
     </navigator>
     <panes>
-      <pane id="Scope" />
       <pane id="Scratches" />
       <pane id="ProjectPane">
         <subPane>
@@ -253,7 +350,7 @@
               <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
             </PATH_ELEMENT>
             <PATH_ELEMENT>
-              <option name="myItemId" value="config" />
+              <option name="myItemId" value="app" />
               <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
             </PATH_ELEMENT>
           </PATH>
@@ -270,13 +367,70 @@
               <option name="myItemId" value="app" />
               <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
             </PATH_ELEMENT>
+            <PATH_ELEMENT>
+              <option name="myItemId" value="templates" />
+              <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
+            </PATH_ELEMENT>
           </PATH>
+          <PATH>
+            <PATH_ELEMENT>
+              <option name="myItemId" value="parkserver" />
+              <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.ProjectViewProjectNode" />
+            </PATH_ELEMENT>
+            <PATH_ELEMENT>
+              <option name="myItemId" value="parkserver" />
+              <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
+            </PATH_ELEMENT>
+            <PATH_ELEMENT>
+              <option name="myItemId" value="app" />
+              <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
+            </PATH_ELEMENT>
+            <PATH_ELEMENT>
+              <option name="myItemId" value="templates" />
+              <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
+            </PATH_ELEMENT>
+            <PATH_ELEMENT>
+              <option name="myItemId" value="sb-admin" />
+              <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
+            </PATH_ELEMENT>
+          </PATH>
+          <PATH>
+            <PATH_ELEMENT>
+              <option name="myItemId" value="parkserver" />
+              <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.ProjectViewProjectNode" />
+            </PATH_ELEMENT>
+            <PATH_ELEMENT>
+              <option name="myItemId" value="parkserver" />
+              <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
+            </PATH_ELEMENT>
+            <PATH_ELEMENT>
+              <option name="myItemId" value="app" />
+              <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
+            </PATH_ELEMENT>
+            <PATH_ELEMENT>
+              <option name="myItemId" value="templates" />
+              <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
+            </PATH_ELEMENT>
+            <PATH_ELEMENT>
+              <option name="myItemId" value="sb-admin" />
+              <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
+            </PATH_ELEMENT>
+            <PATH_ELEMENT>
+              <option name="myItemId" value="pages" />
+              <option name="myItemType" value="com.intellij.ide.projectView.impl.nodes.PsiDirectoryNode" />
+            </PATH_ELEMENT>
+          </PATH>
         </subPane>
       </pane>
+      <pane id="Scope" />
     </panes>
   </component>
   <component name="PropertiesComponent">
+<<<<<<< .mine
+    <property name="last_opened_file_path" value="$PROJECT_DIR$" />
+=======
     <property name="last_opened_file_path" value="$PROJECT_DIR$/../SubinTaskService" />
+>>>>>>> .r325
     <property name="WebServerToolWindowFactoryState" value="false" />
     <property name="settings.editor.selected.configurable" value="com.jetbrains.python.configuration.PyActiveSdkModuleConfigurable" />
     <property name="settings.editor.splitter.proportion" value="0.2" />
@@ -537,6 +691,24 @@
     <configuration useDefault="false">C:\Users\ctamo\AppData\Roaming\Subversion</configuration>
     <supportedVersion>125</supportedVersion>
   </component>
+  <component name="SvnFileUrlMappingImpl">
+    <option name="myMappingRoots">
+      <list>
+        <SvnCopyRootSimple>
+          <option name="myVcsRoot" value="$PROJECT_DIR$" />
+          <option name="myCopyRoot" value="$PROJECT_DIR$" />
+        </SvnCopyRootSimple>
+      </list>
+    </option>
+    <option name="myMoreRealMappingRoots">
+      <list>
+        <SvnCopyRootSimple>
+          <option name="myVcsRoot" value="$PROJECT_DIR$" />
+          <option name="myCopyRoot" value="$PROJECT_DIR$" />
+        </SvnCopyRootSimple>
+      </list>
+    </option>
+  </component>
   <component name="TaskManager">
     <task active="true" id="Default" summary="Default task">
       <changelist id="5d6d8b97-c4e8-4b9e-8b00-024b0cedcc91" name="Default" comment="" />
@@ -547,32 +719,87 @@
     </task>
     <servers />
   </component>
+  <component name="TodoView">
+    <todo-panel id="selected-file">
+      <is-autoscroll-to-source value="true" />
+    </todo-panel>
+    <todo-panel id="all">
+      <are-packages-shown value="true" />
+      <is-autoscroll-to-source value="true" />
+    </todo-panel>
+  </component>
   <component name="ToolWindowManager">
-    <frame x="-8" y="-8" width="1382" height="744" extended-state="6" />
+    <frame x="4" y="26" width="1420" height="817" extended-state="0" />
     <editor active="true" />
     <layout>
+<<<<<<< .mine
+      <window_info id="Project" active="false" anchor="left" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="true" show_stripe_button="true" weight="0.28239438" sideWeight="0.47731397" order="0" side_tool="false" content_ui="combo" />
+      <window_info id="TODO" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.328877" sideWeight="0.5" order="6" side_tool="false" content_ui="tabs" />
+      <window_info id="Event Log" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.48" sideWeight="0.52515244" order="7" side_tool="true" content_ui="tabs" />
+      <window_info id="Database" active="false" anchor="right" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.32930514" sideWeight="0.5" order="3" side_tool="false" content_ui="tabs" />
+=======
       <window_info id="Project" active="false" anchor="left" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="true" show_stripe_button="true" weight="0.29531723" sideWeight="0.5" order="0" side_tool="false" content_ui="combo" />
       <window_info id="TODO" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="6" side_tool="false" content_ui="tabs" />
       <window_info id="Event Log" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.3360522" sideWeight="0.52794564" order="7" side_tool="true" content_ui="tabs" />
       <window_info id="Database" active="false" anchor="right" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="3" side_tool="false" content_ui="tabs" />
+>>>>>>> .r325
+      <window_info id="Version Control" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="7" side_tool="false" content_ui="tabs" />
       <window_info id="Python Console" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="7" side_tool="false" content_ui="tabs" />
+<<<<<<< .mine
+=======
       <window_info id="Version Control" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="7" side_tool="false" content_ui="tabs" />
+>>>>>>> .r325
       <window_info id="Structure" active="false" anchor="left" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.25" sideWeight="0.5" order="1" side_tool="false" content_ui="tabs" />
       <window_info id="Terminal" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="7" side_tool="false" content_ui="tabs" />
+<<<<<<< .mine
+      <window_info id="Favorites" active="false" anchor="left" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.31722054" sideWeight="0.522686" order="2" side_tool="true" content_ui="tabs" />
+=======
       <window_info id="Favorites" active="false" anchor="left" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="2" side_tool="true" content_ui="tabs" />
+>>>>>>> .r325
       <window_info id="SVN Repositories" active="true" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="true" show_stripe_button="true" weight="0.32861635" sideWeight="0.49707174" order="7" side_tool="false" content_ui="tabs" />
       <window_info id="Cvs" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.25" sideWeight="0.5" order="4" side_tool="false" content_ui="tabs" />
       <window_info id="Messages" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="7" side_tool="false" content_ui="tabs" />
       <window_info id="Message" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="0" side_tool="false" content_ui="tabs" />
       <window_info id="Commander" active="false" anchor="right" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.4" sideWeight="0.5" order="0" side_tool="false" content_ui="tabs" />
       <window_info id="Inspection" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.4" sideWeight="0.5" order="5" side_tool="false" content_ui="tabs" />
+<<<<<<< .mine
+      <window_info id="Run" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.2137031" sideWeight="0.47484756" order="2" side_tool="false" content_ui="tabs" />
+=======
       <window_info id="Run" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.45676997" sideWeight="0.4720544" order="2" side_tool="false" content_ui="tabs" />
+>>>>>>> .r325
       <window_info id="SVN Properties" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="true" show_stripe_button="true" weight="0.23427673" sideWeight="0.49707174" order="7" side_tool="false" content_ui="tabs" />
       <window_info id="Hierarchy" active="false" anchor="right" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.25" sideWeight="0.5" order="2" side_tool="false" content_ui="combo" />
       <window_info id="Find" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.32861635" sideWeight="0.49707174" order="1" side_tool="false" content_ui="tabs" />
       <window_info id="Ant Build" active="false" anchor="right" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.25" sideWeight="0.5" order="1" side_tool="false" content_ui="tabs" />
+<<<<<<< .mine
+      <window_info id="Debug" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.41598696" sideWeight="0.51537335" order="3" side_tool="false" content_ui="tabs" />
+=======
       <window_info id="Debug" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.24528302" sideWeight="0.51537335" order="3" side_tool="false" content_ui="tabs" />
+>>>>>>> .r325
     </layout>
+    <layout-to-restore>
+      <window_info id="SVN Repositories" active="true" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="true" show_stripe_button="true" weight="0.32861635" sideWeight="0.49707174" order="7" side_tool="false" content_ui="tabs" />
+      <window_info id="TODO" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.328877" sideWeight="0.5" order="6" side_tool="false" content_ui="tabs" />
+      <window_info id="Cvs" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.25" sideWeight="0.5" order="4" side_tool="false" content_ui="tabs" />
+      <window_info id="Messages" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="8" side_tool="false" content_ui="tabs" />
+      <window_info id="Message" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="0" side_tool="false" content_ui="tabs" />
+      <window_info id="Commander" active="false" anchor="right" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.4" sideWeight="0.5" order="0" side_tool="false" content_ui="tabs" />
+      <window_info id="Event Log" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.48" sideWeight="0.52515244" order="9" side_tool="true" content_ui="tabs" />
+      <window_info id="Inspection" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.4" sideWeight="0.5" order="5" side_tool="false" content_ui="tabs" />
+      <window_info id="Version Control" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="10" side_tool="false" content_ui="tabs" />
+      <window_info id="Python Console" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="11" side_tool="false" content_ui="tabs" />
+      <window_info id="Run" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.2137031" sideWeight="0.47484756" order="2" side_tool="false" content_ui="tabs" />
+      <window_info id="SVN Properties" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="true" show_stripe_button="true" weight="0.23427673" sideWeight="0.49707174" order="12" side_tool="false" content_ui="tabs" />
+      <window_info id="Terminal" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.33" sideWeight="0.5" order="13" side_tool="false" content_ui="tabs" />
+      <window_info id="Project" active="false" anchor="left" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="true" show_stripe_button="true" weight="0.25" sideWeight="0.47731397" order="0" side_tool="false" content_ui="combo" />
+      <window_info id="Hierarchy" active="false" anchor="right" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.25" sideWeight="0.5" order="2" side_tool="false" content_ui="combo" />
+      <window_info id="Database" active="false" anchor="right" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.32930514" sideWeight="0.5" order="3" side_tool="false" content_ui="tabs" />
+      <window_info id="Find" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.32626426" sideWeight="0.49707174" order="1" side_tool="false" content_ui="tabs" />
+      <window_info id="Structure" active="false" anchor="left" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.25" sideWeight="0.5" order="1" side_tool="false" content_ui="tabs" />
+      <window_info id="Ant Build" active="false" anchor="right" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.25" sideWeight="0.5" order="1" side_tool="false" content_ui="tabs" />
+      <window_info id="Favorites" active="false" anchor="left" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.31722054" sideWeight="0.522686" order="2" side_tool="true" content_ui="tabs" />
+      <window_info id="Debug" active="false" anchor="bottom" auto_hide="false" internal_type="DOCKED" type="DOCKED" visible="false" show_stripe_button="true" weight="0.41598696" sideWeight="0.51537335" order="3" side_tool="false" content_ui="tabs" />
+    </layout-to-restore>
   </component>
   <component name="Vcs.Log.UiProperties">
     <option name="RECENTLY_FILTERED_USER_GROUPS">
@@ -624,17 +851,29 @@
         </line-breakpoint>
         <line-breakpoint enabled="true" type="python-line">
           <url>file://$PROJECT_DIR$/app/views.py</url>
+<<<<<<< .mine
+          <line>2103</line>
+=======
           <line>1727</line>
+>>>>>>> .r325
           <option name="timeStamp" value="7" />
         </line-breakpoint>
         <line-breakpoint enabled="true" type="python-line">
           <url>file://$PROJECT_DIR$/app/views.py</url>
+<<<<<<< .mine
+          <line>2170</line>
+=======
           <line>1791</line>
+>>>>>>> .r325
           <option name="timeStamp" value="8" />
         </line-breakpoint>
         <line-breakpoint enabled="true" type="python-line">
           <url>file://$PROJECT_DIR$/app/views.py</url>
+<<<<<<< .mine
+          <line>2291</line>
+=======
           <line>1892</line>
+>>>>>>> .r325
           <option name="timeStamp" value="9" />
         </line-breakpoint>
         <line-breakpoint enabled="true" type="python-line">
@@ -723,17 +962,73 @@
           <option name="timeStamp" value="33" />
         </line-breakpoint>
         <line-breakpoint enabled="true" type="python-line">
+<<<<<<< .mine
+          <url>file://$PROJECT_DIR$/app/views.py</url>
+          <line>1882</line>
+          <option name="timeStamp" value="61" />
+=======
           <url>file://$PROJECT_DIR$/app/route.py</url>
           <line>201</line>
           <option name="timeStamp" value="34" />
+>>>>>>> .r325
         </line-breakpoint>
         <line-breakpoint enabled="true" type="python-line">
           <url>file://$PROJECT_DIR$/app/BarCodeObject.py</url>
           <line>249</line>
           <option name="timeStamp" value="37" />
         </line-breakpoint>
+<<<<<<< .mine
+        <line-breakpoint enabled="true" type="python-line">
+          <url>file://$PROJECT_DIR$/app/views.py</url>
+          <line>1665</line>
+          <option name="timeStamp" value="69" />
+        </line-breakpoint>
+        <line-breakpoint enabled="true" type="python-line">
+          <url>file://$PROJECT_DIR$/app/views.py</url>
+          <line>1917</line>
+          <option name="timeStamp" value="72" />
+        </line-breakpoint>
+        <line-breakpoint enabled="true" type="python-line">
+          <url>file://$PROJECT_DIR$/app/views.py</url>
+          <line>1994</line>
+          <option name="timeStamp" value="76" />
+        </line-breakpoint>
+        <line-breakpoint enabled="true" type="python-line">
+          <url>file://$PROJECT_DIR$/app/test/testdata.py</url>
+          <line>9</line>
+          <option name="timeStamp" value="84" />
+        </line-breakpoint>
+        <line-breakpoint enabled="true" type="python-line">
+          <url>file://$PROJECT_DIR$/app/views.py</url>
+          <line>1321</line>
+          <option name="timeStamp" value="86" />
+        </line-breakpoint>
+=======
+>>>>>>> .r325
+        <line-breakpoint enabled="true" type="python-line">
+          <url>file://$PROJECT_DIR$/app/UserLogin.py</url>
+          <option name="timeStamp" value="88" />
+        </line-breakpoint>
+        <line-breakpoint enabled="true" type="python-line">
+          <url>file://$PROJECT_DIR$/app/models.py</url>
+          <option name="timeStamp" value="89" />
+        </line-breakpoint>
+        <line-breakpoint enabled="true" type="python-line">
+          <url>file://$PROJECT_DIR$/app/CouponDiscount.py</url>
+          <line>50</line>
+          <option name="timeStamp" value="90" />
+        </line-breakpoint>
+        <line-breakpoint enabled="true" type="python-line">
+          <url>file://$PROJECT_DIR$/app/views.py</url>
+          <line>2003</line>
+          <option name="timeStamp" value="91" />
+        </line-breakpoint>
       </breakpoints>
+<<<<<<< .mine
+      <option name="time" value="92" />
+=======
       <option name="time" value="38" />
+>>>>>>> .r325
     </breakpoint-manager>
     <watches-manager>
       <configuration name="PythonConfigurationType">
@@ -742,120 +1037,265 @@
     </watches-manager>
   </component>
   <component name="editorHistoryManager">
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/ParkingAliTicket.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/dashboard.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="2603">
+          <caret line="137" column="0" selection-start-line="137" selection-start-column="0" selection-end-line="137" selection-end-column="0" />
+=======
         <state relative-caret-position="171">
           <caret line="52" column="16" selection-start-line="52" selection-start-column="16" selection-end-line="52" selection-end-column="16" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/../default.py" />
+    <entry file="file://C:/Python34/Lib/site-packages/werkzeug/contrib/atom.py" />
+    <entry file="file://C:/Python34/Lib/site-packages/flask_admin/model/base.py" />
+    <entry file="file://$USER_HOME$/.PyCharm2016.1/system/python_stubs/-1442825926/time.py" />
+    <entry file="file://$PROJECT_DIR$/config/__init__.py">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/edit.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="399">
+          <caret line="21" column="21" selection-start-line="21" selection-start-column="15" selection-end-line="21" selection-end-column="21" />
+=======
         <state relative-caret-position="190">
           <caret line="10" column="16" selection-start-line="10" selection-start-column="16" selection-end-line="10" selection-end-column="16" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/supervisor/parkserver.conf">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/create.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="95">
+          <caret line="5" column="0" selection-start-line="5" selection-start-column="0" selection-end-line="5" selection-end-column="0" />
+=======
         <state relative-caret-position="0">
           <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/manage.py">
+=======
     <entry file="file://$USER_HOME$/.PyCharm2016.1/system/python_stubs/-1442825926/builtins.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="342">
+          <caret line="18" column="0" selection-start-line="18" selection-start-column="0" selection-end-line="18" selection-end-column="0" />
+=======
         <state relative-caret-position="161">
           <caret line="5114" column="8" selection-start-line="5114" selection-start-column="8" selection-end-line="5114" selection-end-column="8" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://C:/Python34/Lib/site-packages/flask/wrappers.py" />
+    <entry file="file://C:/Python34/Lib/site-packages/gridfs/grid_file.py" />
+    <entry file="file://C:/Python34/Lib/site-packages/mongoengine/fields.py" />
+    <entry file="file://$PROJECT_DIR$/requirements.txt">
+=======
     <entry file="file://C:/Python34/Lib/site-packages/mongoengine/queryset/manager.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="304">
+          <caret line="16" column="16" selection-start-line="16" selection-start-column="16" selection-end-line="16" selection-end-column="16" />
+=======
         <state relative-caret-position="123">
           <caret line="45" column="0" selection-start-line="45" selection-start-column="0" selection-end-line="45" selection-end-column="0" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/couponrule.py" />
+    <entry file="file://$PROJECT_DIR$/config/default.py">
+=======
     <entry file="file://C:/Python34/Lib/site-packages/flask_admin/base.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="285">
+          <caret line="19" column="4" selection-start-line="19" selection-start-column="4" selection-end-line="19" selection-end-column="4" />
+=======
         <state relative-caret-position="104">
           <caret line="339" column="8" selection-start-line="339" selection-start-column="8" selection-end-line="339" selection-end-column="8" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/test/testdata.py">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/adminList.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="60">
+          <caret line="4" column="0" selection-start-line="4" selection-start-column="0" selection-end-line="4" selection-end-column="0" />
+          <folding />
+=======
         <state relative-caret-position="0">
           <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/myAli.py">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/list.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="258">
+          <caret line="54" column="45" selection-start-line="54" selection-start-column="43" selection-end-line="54" selection-end-column="45" />
+=======
         <state relative-caret-position="190">
           <caret line="10" column="0" selection-start-line="10" selection-start-column="0" selection-end-line="10" selection-end-column="0" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/stub.py">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/master.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="258">
+          <caret line="27" column="64" selection-start-line="27" selection-start-column="62" selection-end-line="27" selection-end-column="64" />
+          <folding />
+=======
         <state relative-caret-position="133">
           <caret line="7" column="36" selection-start-line="7" selection-start-column="36" selection-end-line="7" selection-end-column="36" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/CryptManager.py">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/base.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="-420">
+          <caret line="30" column="13" selection-start-line="30" selection-start-column="13" selection-end-line="30" selection-end-column="13" />
+=======
         <state relative-caret-position="19">
           <caret line="28" column="59" selection-start-line="28" selection-start-column="59" selection-end-line="28" selection-end-column="59" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/retrying.py">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/nav.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="600">
+          <caret line="126" column="53" selection-start-line="126" selection-start-column="53" selection-end-line="126" selection-end-column="53" />
+=======
         <state relative-caret-position="570">
           <caret line="30" column="107" selection-start-line="30" selection-start-column="103" selection-end-line="30" selection-end-column="107" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/logger.py">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/macros/navlink.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="180">
+          <caret line="15" column="33" selection-start-line="15" selection-start-column="33" selection-end-line="15" selection-end-column="33" />
+=======
         <state relative-caret-position="152">
           <caret line="8" column="14" selection-start-line="8" selection-start-column="14" selection-end-line="8" selection-end-column="14" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/blank.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/macros/topnav/alert.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
         <state relative-caret-position="0">
           <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/edit.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/macros/topnav/messagesummary.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
         <state relative-caret-position="0">
           <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/create.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/security/login_user.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
         <state relative-caret-position="0">
           <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/macros/dashboard/timeline.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/templates/security/change_password.html">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="0">
+          <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+=======
         <state relative-caret-position="285">
           <caret line="15" column="115" selection-start-line="15" selection-start-column="110" selection-end-line="15" selection-end-column="115" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/macros/dashboard/chat.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/stub.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+=======
         <state relative-caret-position="475">
           <caret line="25" column="40" selection-start-line="25" selection-start-column="40" selection-end-line="25" selection-end-column="40" />
           <folding />
@@ -865,137 +1305,319 @@
     <entry file="file://$PROJECT_DIR$/app/tasks.py" />
     <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/macros/topnav/tasksummary.html">
       <provider selected="true" editor-type-id="text-editor">
+>>>>>>> .r325
         <state relative-caret-position="0">
           <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/macros/tables/table.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/alipay_api.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="150">
+          <caret line="10" column="11" selection-start-line="10" selection-start-column="11" selection-end-line="10" selection-end-column="11" />
+=======
         <state relative-caret-position="893">
           <caret line="57" column="12" selection-start-line="57" selection-start-column="12" selection-end-line="57" selection-end-column="12" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/BarCodeObject.py">
+=======
     <entry file="file://C:/Python34/Lib/site-packages/flask_login.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="6705">
+          <caret line="457" column="27" selection-start-line="457" selection-start-column="27" selection-end-line="457" selection-end-column="27" />
+          <folding />
+=======
         <state relative-caret-position="608">
           <caret line="46" column="0" selection-start-line="46" selection-start-column="0" selection-end-line="46" selection-end-column="0" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/WechatTools.py">
+=======
     <entry file="file://$PROJECT_DIR$/app/bower.json">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="3405">
+          <caret line="239" column="111" selection-start-line="239" selection-start-column="97" selection-end-line="239" selection-end-column="111" />
+          <folding />
+=======
         <state relative-caret-position="285">
           <caret line="15" column="19" selection-start-line="15" selection-start-column="19" selection-end-line="15" selection-end-column="19" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/UserLogin.py">
+=======
     <entry file="file://C:/Python34/Lib/site-packages/flask_admin/model/base.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="240">
+          <caret line="31" column="8" selection-start-line="31" selection-start-column="8" selection-end-line="31" selection-end-column="8" />
+          <folding />
+=======
         <state relative-caret-position="23351">
           <caret line="1257" column="0" selection-start-line="1257" selection-start-column="0" selection-end-line="1257" selection-end-column="0" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/models.py">
+=======
     <entry file="file://$PROJECT_DIR$/app/logging.config.py" />
     <entry file="file://$PROJECT_DIR$/app/bower_components/bootstrap/Gruntfile.js">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="435">
+          <caret line="262" column="10" selection-start-line="262" selection-start-column="10" selection-end-line="262" selection-end-column="10" />
+          <folding>
+            <element signature="e#0#15#0" expanded="true" />
+          </folding>
+=======
         <state relative-caret-position="141">
           <caret line="45" column="57" selection-start-line="45" selection-start-column="57" selection-end-line="45" selection-end-column="57" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/test/coupontest.py">
+=======
     <entry file="file://C:/Python34/Lib/site-packages/werkzeug/serving.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="1050">
+          <caret line="360" column="8" selection-start-line="360" selection-start-column="8" selection-end-line="360" selection-end-column="8" />
+          <folding />
+=======
         <state relative-caret-position="281">
           <caret line="192" column="12" selection-start-line="192" selection-start-column="12" selection-end-line="192" selection-end-column="12" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/CouponDiscount.py">
+=======
     <entry file="file://C:/Python34/Lib/datetime.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="258">
+          <caret line="25" column="54" selection-start-line="25" selection-start-column="54" selection-end-line="25" selection-end-column="54" />
+          <folding>
+            <element signature="e#157#172#0" expanded="true" />
+          </folding>
+=======
         <state relative-caret-position="396">
           <caret line="1289" column="6" selection-start-line="1289" selection-start-column="6" selection-end-line="1289" selection-end-column="6" />
           <folding />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/modals/edit.html">
+=======
     <entry file="file://C:/Python34/Lib/site-packages/flask/app.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="0">
+          <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+          <folding />
+=======
         <state relative-caret-position="396">
           <caret line="1469" column="39" selection-start-line="1469" selection-start-column="39" selection-end-line="1469" selection-end-column="39" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/modals/details.html">
+=======
     <entry file="file://C:/Python34/Lib/site-packages/werkzeug/debug/__init__.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="0">
+          <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+          <folding />
+=======
         <state relative-caret-position="396">
           <caret line="202" column="0" selection-start-line="202" selection-start-column="0" selection-end-line="202" selection-end-column="0" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/modals/create.html">
+=======
     <entry file="file://C:/Python34/Lib/logging/__init__.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="0">
+          <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+          <folding />
+=======
         <state relative-caret-position="1427">
           <caret line="120" column="14" selection-start-line="120" selection-start-column="7" selection-end-line="120" selection-end-column="14" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/loginbase.html">
+=======
     <entry file="file://$PROJECT_DIR$/config/development_sample.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="-264">
+          <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+          <folding />
+=======
         <state relative-caret-position="0">
           <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/index.html">
+=======
     <entry file="file://$PROJECT_DIR$/config/production_sample.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
         <state relative-caret-position="0">
           <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+          <folding />
+=======
+        <state relative-caret-position="0">
+          <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/adminList.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/CryptManager.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="0">
+          <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+          <folding />
+=======
         <state relative-caret-position="1729">
           <caret line="91" column="54" selection-start-line="91" selection-start-column="54" selection-end-line="91" selection-end-column="54" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/tables.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/DataAnalysis.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
         <state relative-caret-position="0">
           <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+          <folding />
+=======
+        <state relative-caret-position="0">
+          <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/morris.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/route.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="336">
+          <caret line="29" column="173" selection-start-line="29" selection-start-column="173" selection-end-line="29" selection-end-column="173" />
+          <folding />
+=======
         <state relative-caret-position="1938">
           <caret line="102" column="0" selection-start-line="102" selection-start-column="0" selection-end-line="102" selection-end-column="0" />
           <folding>
             <element signature="e#0#11#0" expanded="false" />
           </folding>
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/base.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/myAli.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="126">
+          <caret line="41" column="18" selection-start-line="41" selection-start-column="18" selection-end-line="41" selection-end-column="18" />
+          <folding />
+=======
         <state relative-caret-position="4655">
           <caret line="256" column="33" selection-start-line="256" selection-start-column="33" selection-end-line="256" selection-end-column="33" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/flot.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/UserLogin.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="480">
+          <caret line="32" column="351" selection-start-line="32" selection-start-column="351" selection-end-line="32" selection-end-column="351" />
+          <folding />
+=======
         <state relative-caret-position="4902">
           <caret line="273" column="28" selection-start-line="273" selection-start-column="28" selection-end-line="273" selection-end-column="28" />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/list.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/logger.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="261">
+          <caret line="222" column="65" selection-start-line="222" selection-start-column="64" selection-end-line="222" selection-end-column="65" />
+=======
         <state relative-caret-position="152">
           <caret line="11" column="33" selection-start-line="11" selection-start-column="33" selection-end-line="11" selection-end-column="33" />
         </state>
@@ -1023,19 +1645,33 @@
       <provider selected="true" editor-type-id="text-editor">
         <state relative-caret-position="6498">
           <caret line="365" column="65" selection-start-line="365" selection-start-column="65" selection-end-line="365" selection-end-column="65" />
+>>>>>>> .r325
           <folding />
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/forms.html">
+=======
     <entry file="file://C:/Python34/Lib/site-packages/PIL/OleFileIO.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="-540">
+          <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+=======
         <state relative-caret-position="11666">
           <caret line="614" column="13" selection-start-line="614" selection-start-column="13" selection-end-line="614" selection-end-column="13" />
+>>>>>>> .r325
           <folding />
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/master.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/WechatTools.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
         <state relative-caret-position="8569">
           <caret line="451" column="50" selection-start-line="451" selection-start-column="50" selection-end-line="451" selection-end-column="50" />
@@ -1045,46 +1681,107 @@
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/nav.html">
+=======
     <entry file="file://$PROJECT_DIR$/config/__init__.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="0">
+          <caret line="0" column="0" selection-start-line="0" selection-start-column="0" selection-end-line="0" selection-end-column="0" />
+=======
         <state relative-caret-position="380">
           <caret line="20" column="21" selection-start-line="20" selection-start-column="14" selection-end-line="20" selection-end-column="21" />
+>>>>>>> .r325
           <folding />
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/pages/dashboard.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/models.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="405">
+          <caret line="27" column="0" selection-start-line="27" selection-start-column="0" selection-end-line="27" selection-end-column="0" />
+=======
         <state relative-caret-position="817">
           <caret line="48" column="6" selection-start-line="48" selection-start-column="6" selection-end-line="48" selection-end-column="6" />
+>>>>>>> .r325
           <folding />
         </state>
       </provider>
     </entry>
-    <entry file="file://$PROJECT_DIR$/app/views.py">
+    <entry file="file://$PROJECT_DIR$/app/route.py">
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="231">
+          <caret line="430" column="14" selection-start-line="430" selection-start-column="12" selection-end-line="430" selection-end-column="14" />
+          <folding>
+            <element signature="e#0#11#0" expanded="true" />
+          </folding>
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/app/__init__.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="213">
+          <caret line="81" column="13" selection-start-line="81" selection-start-column="13" selection-end-line="81" selection-end-column="13" />
+          <folding>
+            <element signature="e#0#23#0" expanded="true" />
+          </folding>
+=======
         <state relative-caret-position="604">
           <caret line="552" column="63" selection-start-line="552" selection-start-column="63" selection-end-line="552" selection-end-column="63" />
           <folding />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/templates/sb-admin/redirect.html">
+=======
     <entry file="file://$PROJECT_DIR$/app/retrying.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="135">
+          <caret line="9" column="7" selection-start-line="9" selection-start-column="7" selection-end-line="9" selection-end-column="7" />
+=======
         <state relative-caret-position="4427">
           <caret line="237" column="34" selection-start-line="237" selection-start-column="34" selection-end-line="237" selection-end-column="34" />
+>>>>>>> .r325
           <folding />
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+    <entry file="file://$PROJECT_DIR$/app/views.py">
+=======
     <entry file="file://$PROJECT_DIR$/app/BarCodeObject.py">
+>>>>>>> .r325
       <provider selected="true" editor-type-id="text-editor">
+<<<<<<< .mine
+        <state relative-caret-position="1035">
+          <caret line="1920" column="29" selection-start-line="1920" selection-start-column="29" selection-end-line="1920" selection-end-column="29" />
+          <folding>
+            <element signature="e#0#10#0" expanded="true" />
+            <element signature="e#21092#25941#0" expanded="false" />
+            <element signature="e#32297#50163#0" expanded="false" />
+          </folding>
+=======
         <state relative-caret-position="228">
           <caret line="22" column="35" selection-start-line="22" selection-start-column="29" selection-end-line="22" selection-end-column="35" />
           <folding />
+>>>>>>> .r325
         </state>
       </provider>
     </entry>
+<<<<<<< .mine
+=======
     <entry file="file://$PROJECT_DIR$/config/default.py">
       <provider selected="true" editor-type-id="text-editor">
         <state relative-caret-position="358">
@@ -1093,5 +1790,6 @@
         </state>
       </provider>
     </entry>
+>>>>>>> .r325
   </component>
 </project>
\ No newline at end of file
Index: parkserver/app/UserLogin.py
===================================================================
--- parkserver/app/UserLogin.py	(revision 328)
+++ parkserver/app/UserLogin.py	(working copy)
@@ -4,7 +4,8 @@
 import time as systemTime
 import hashlib
 from .models import User, UserOrder, CouponManagement, UserCouponModel, ParkManagement, PropertyCompany, CouponSubCode, \
-    InvoiceManagement
+    InvoiceManagement, ConsumptionCoupon
+from app.CouponDiscount import CouponDiscount
 import random
 import json
 import time
@@ -30,6 +31,7 @@
 COUPON_STATUS_NOT_START = 3  # 未开始，不可以使用
 
 mBarCode = BarCode()
+mCouponDiscout = CouponDiscount()
 
 
 class GetImage:
@@ -117,15 +119,33 @@
 
         coupon_price = 0
 
-        if (chooseCouponId != None and len(chooseCouponId) >= 6):
-            mUserCouponModel = UserCouponModel.objects(coupon_id=chooseCouponId).first()
-            if (mUserCouponModel != None):
-                coupon_price = mUserCouponModel.coupon_price
-
+        #logging.debug("传进来的chooseCouponId:" + chooseCouponId)
+        #if (chooseCouponId != None and len(chooseCouponId) >= 6):
+        #    mUserCouponModel = UserCouponModel.objects(coupon_id=chooseCouponId).first()
+        #    if (mUserCouponModel != None):
+        #        coupon_price = mUserCouponModel.coupon_price
+        CouponIds = chooseCouponId.split(";")  # TODO
+        #logging.debug("这里呢：" + chooseCouponId)
+        for _chooseCouponId in CouponIds:
+            if (_chooseCouponId != None and len(_chooseCouponId) >= 6):
+                mUserCouponModel = UserCouponModel.objects(coupon_id=_chooseCouponId).first()
+                if (mUserCouponModel != None):
+                    coupon_price += float(mUserCouponModel.coupon_price)
+        
         seller_name = ''
-        mCouponManagement = CouponManagement.objects(coupon_id=chooseCouponId).first()
-        if (mCouponManagement != None):
-            seller_name = mCouponManagement.seller_name
+        logging.debug("计算完price:" + chooseCouponId)
+        #mCouponManagement = CouponManagement.objects(coupon_id=chooseCouponId).first()
+        #if (mCouponManagement != None):
+        #    seller_name = mCouponManagement.seller_name
+        seller_names = []  # TODO
+        for _chooseCouponId in CouponIds:
+            mCouponManagement = CouponManagement.objects(coupon_id=_chooseCouponId).first()
+            if (mCouponManagement != None):
+                if mCouponManagement.seller_name != None:
+                    seller_names.append(mCouponManagement.seller_name)
+        seller_names = list(set(seller_names))
+        seller_name = ",".join(seller_names)
+        #logging.debug("计算完seller_name:" + chooseCouponId)
 
         coupon_price = str(coupon_price)
         Price = str('%0.2f' % float(Price))
@@ -154,6 +174,7 @@
                               payway=payway,
                               seller_name=seller_name)
         else:
+            #logging.debug('chooseCouponId:' + chooseCouponId)
             mUserOrder = UserOrder(ticket=Ticket,
                                    wechat_id=nickName,
                                    wechat_openId=openId,
@@ -188,24 +209,28 @@
         if (myUserOrder != None):
             payTime = datetime.datetime.now()
             myUserOrder.update(wechat_openId=openId, isPaid=True, pay_time=payTime)
-            if (len(chooseCouponId) > 0 and myUserOrder.isPaid == False):
-                mUserCouponModel = UserCouponModel.objects(coupon_id=chooseCouponId, coupon_status=COUPON_STATUS_VAILD,
+            # TODO
+            CouponIds = chooseCouponId.split(";")
+            for _chooseCouponId in CouponIds:
+                if (len(_chooseCouponId) > 0 and myUserOrder.isPaid == False):
+                    mUserCouponModel = UserCouponModel.objects(coupon_id=_chooseCouponId, coupon_status=COUPON_STATUS_VAILD,
                                                            wechat_openId=openId).first()
-                if (mUserCouponModel != None):
-                    if (mUserCouponModel.receive_count > 0 and mUserCouponModel.receive_count == 1):
-                        mUserCouponModel.update(coupon_id=chooseCouponId, coupon_status=COUPON_STATUS_USED,
+                    if (mUserCouponModel != None):
+                        if (mUserCouponModel.receive_count > 0 and mUserCouponModel.receive_count == 1):
+                            mUserCouponModel.update(coupon_id=_chooseCouponId, coupon_status=COUPON_STATUS_USED,
                                                 receive_count=0)
-                    elif (mUserCouponModel.receive_count > 0 and mUserCouponModel.receive_count > 1):
-                        mUserCouponModel.receive_count = mUserCouponModel.receive_count - 1
-                        mUserCouponModel.update(coupon_id=chooseCouponId, receive_count=mUserCouponModel.receive_count)
-                else:
-                    return {'code': RESULT_ERROR, 'msg': '优惠券不存在'}
+                        elif (mUserCouponModel.receive_count > 0 and mUserCouponModel.receive_count > 1):
+                            mUserCouponModel.receive_count = mUserCouponModel.receive_count - 1
+                            mUserCouponModel.update(coupon_id=_chooseCouponId, receive_count=mUserCouponModel.receive_count)
+                    else:
+                        return {'code': RESULT_ERROR, 'msg': '优惠券不存在'}
 
-                # 提交已经使用掉的卡券数量
-                mCouponManagement = CouponManagement.objects(coupon_id=chooseCouponId).first()
-                if (mCouponManagement != None):
-                    mCouponManagement.used_amount = mCouponManagement.used_amount + 1
-                    mCouponManagement.update(coupon_id=chooseCouponId, used_amount=mCouponManagement.used_amount)
+                    # 提交已经使用掉的卡券数量
+                    mCouponManagement = CouponManagement.objects(coupon_id=_chooseCouponId).first()
+                    if (mCouponManagement != None):
+                        mCouponManagement.used_amount = mCouponManagement.used_amount + 1
+                        mCouponManagement.update(coupon_id=_chooseCouponId, used_amount=mCouponManagement.used_amount)
+            # TODO
             if (float(price) > 0):
                 if payway == '1':
                     mBarCode.callServiceByLpn(parkId, lpn, float(myUserOrder.ActualPrice), myUserOrder.seq, True)
@@ -223,20 +248,23 @@
         if (myUserOrder != None and myUserOrder.isPaid == False):
             payTime = datetime.datetime.now()
             myUserOrder.update(wechat_openId=openId, isPaid=True, pay_time=payTime)
-            if (len(chooseCouponId) > 0):
-                mUserCouponModel = UserCouponModel.objects(coupon_id=chooseCouponId).first()
-                if (mUserCouponModel != None):
-                    if (mUserCouponModel.receive_count > 0 and mUserCouponModel.receive_count == 1):
-                        mUserCouponModel.update(coupon_id=chooseCouponId, coupon_status=COUPON_STATUS_USED,
+            # TODO
+            CouponIds = chooseCouponId.split(";")
+            for _chooseCouponId in CouponIds:
+                if (len(_chooseCouponId) > 0):
+                    mUserCouponModel = UserCouponModel.objects(coupon_id=_chooseCouponId).first()
+                    if (mUserCouponModel != None):
+                        if (mUserCouponModel.receive_count > 0 and mUserCouponModel.receive_count == 1):
+                            mUserCouponModel.update(coupon_id=_chooseCouponId, coupon_status=COUPON_STATUS_USED,
                                                 receive_count=0)
-                    elif (mUserCouponModel.receive_count > 0 and mUserCouponModel.receive_count > 1):
-                        mUserCouponModel.receive_count = mUserCouponModel.receive_count - 1
-                        mUserCouponModel.update(coupon_id=chooseCouponId, receive_count=mUserCouponModel.receive_count)
-                # 提交已经使用掉的卡券数量
-                mCouponManagement = CouponManagement.objects(coupon_id=chooseCouponId).first()
-                if (mCouponManagement != None):
-                    mCouponManagement.used_amount = mCouponManagement.used_amount + 1
-                    mCouponManagement.update(coupon_id=chooseCouponId, used_amount=mCouponManagement.used_amount)
+                        elif (mUserCouponModel.receive_count > 0 and mUserCouponModel.receive_count > 1):
+                            mUserCouponModel.receive_count = mUserCouponModel.receive_count - 1
+                            mUserCouponModel.update(coupon_id=_chooseCouponId, receive_count=mUserCouponModel.receive_count)
+                    # 提交已经使用掉的卡券数量
+                    mCouponManagement = CouponManagement.objects(coupon_id=_chooseCouponId).first()
+                    if (mCouponManagement != None):
+                        mCouponManagement.used_amount = mCouponManagement.used_amount + 1
+                        mCouponManagement.update(coupon_id=_chooseCouponId, used_amount=mCouponManagement.used_amount)
 
             mBarCode.callService(Ticket, myUserOrder.ActualPrice, myUserOrder.seq,False)
         else:
@@ -444,10 +472,12 @@
 
                         if (mUserCouponModel.receive_count <= 0):
                             mUserCouponModel.receive_count = 0
+                        #mUserCouponModel.coupon_price = int(mUserCouponModel.coupon_price) + int(mCouponManagement.price)  # TODO
                         mUserCouponModel.total_count = mUserCouponModel.total_count + 1
                         mUserCouponModel.receive_count = mUserCouponModel.receive_count + 1
                         mUserCouponModel.update(coupon_id=mUserCouponModel.coupon_id,
                                                 receive_count=mUserCouponModel.receive_count,
+                                                #coupon_price = mUserCouponModel.coupon_price,  # TODO
                                                 coupon_status=COUPON_STATUS_VAILD,
                                                 total_count=mUserCouponModel.total_count,
                                                 coupon_validity=str(mCouponManagement.valid_date),
@@ -474,6 +504,7 @@
                                                        coupon_id=couponId,
                                                        park_name=str(parksName),
                                                        coupon_name=str(mCouponManagement.coupon_name),
+                                                       coupon_type='0',
                                                        coupon_status=COUPON_STATUS_VAILD,
                                                        coupon_price=mCouponManagement.price,
                                                        # coupon_validity=str(getTime[0]),
@@ -495,15 +526,83 @@
             return {'code': RESULT_ERROR, 'msg': '优惠券码有误，请重试'}
 
     # 用户消费换取优惠券
-    def exchangeUserCoupon(self, openId, obj, discount):
-        mCouponManagement = CouponManagement.objects(coupon_id=obj.id).first()
-        if (mCouponManagement != None):
+    def exchangeUserCoupon(self, openId, obj, price):
+        #mCouponManagement = CouponManagement.objects(guid=obj['id']).first()  # TODO
+        only_coupon = ConsumptionCoupon.objects(coupon_id=obj['id']).first()
+        eCouponManagement = CouponManagement.objects(weichat_id=openId, used_amount=0, coupon_type='1', start_date=datetime.datetime.strptime(str(datetime.date.today()),
+                                                                                            "%Y-%m-%d")).first()
+        #eUserCouponModel = UserCouponModel.objects(wechat_openId=openId,coupon_status=1).first()
+        if (only_coupon != None):
             return {'code': 0, 'msg': '该二维码卡券已使用'}
         else:
             mPropertyCompany = ParkManagement.objects(park_id=obj['system']).first()
             if (mPropertyCompany != None):
-                mCouponManagement = CouponManagement(coupon_name='临时消费卡券',
-                                                coupon_id=openId,
+                discount = mCouponDiscout.coupon_discount(openId,obj['system'],price)
+                mConsumptionCoupon = ConsumptionCoupon(weichat_id=openId,
+                                                       coupon_name='临时消费卡券',
+                                                       coupon_id=obj['id'],
+                                                       price=str(discount),
+                                                       start_date=datetime.datetime.strptime(
+                                                           str(datetime.date.today()),
+                                                           "%Y-%m-%d"),
+                                                       valid_date=datetime.datetime.strptime(
+                                                           str(datetime.date.today()),
+                                                           '%Y-%m-%d') + datetime.timedelta(
+                                                           days=+0, hours=+23, minutes=+59, seconds=+59),
+                                                       receive_count='1',
+                                                       coupon_type='1',
+                                                       amount='1',
+                                                       received_amount=1,
+                                                       parks=obj['system'] + ':' + mPropertyCompany.park_name,
+                                                       park_id=obj['system'],
+                                                       company_name=mPropertyCompany.company.company_name,
+                                                       coupon_status='1:已激活',
+                                                       seller_name=obj['seller'],
+                                                       monetary=obj['price'],
+                                                       )
+                mConsumptionCoupon.save()
+                if (eCouponManagement != None):
+                    #monetary = eCouponManagement.monetary + price
+                    #new_monetary = eCouponManagement.monetary + obj['price']
+                    old_monetary = float(eCouponManagement.monetary)
+                    given_price = float(price)
+                    monetary = old_monetary + given_price
+                    new_price = mCouponDiscout.coupon_discount(openId,obj['system'],monetary)
+                    new_seller_name = eCouponManagement.seller_name + ',' + obj['seller']
+                    last_seller = eCouponManagement.seller_name.split(',')[-1]
+                    if last_seller == obj['seller']:
+                        new_seller_name = eCouponManagement.seller_name
+                    eCouponManagement.update(
+                                                price=str(new_price),
+                                                monetary=str(monetary),
+                                                seller_name=new_seller_name
+                    )
+                    eCouponManagement.save()
+
+                    mUser = User.objects(wechat_openId=openId).first()
+                    eUserCouponModel = UserCouponModel.objects(wechat_openId=openId,coupon_status=1,coupon_type="1").first()
+                    if (eUserCouponModel != None):
+                        eUserCouponModel.update(coupon_price=str(new_price))
+                        eUserCouponModel.save()
+                    #else:
+                    #    mUserCouponModel = UserCouponModel(wechat_openId=openId,
+                    #                                   coupon_id=openId,
+                    #                                   park_name=str(mPropertyCompany.park_name),
+                    #                                   coupon_name=str(mCouponManagement.coupon_name),
+                    #                                   coupon_status=COUPON_STATUS_VAILD,
+                    #                                   coupon_price=mCouponManagement.price,
+                    #                                   coupon_validity=str(mCouponManagement.valid_date),
+                    #                                   receive_count=1,
+                    #                                   total_count=1,
+                    #                                   coupon_start=str(mCouponManagement.start_date))
+                    #    mUserCouponModel.save()    
+                    #    mUser.coupon_list.append(eUserCouponModel)  # TODO
+                    mUser.update(wechat_openId=openId, coupon_list=mUser.coupon_list)  # TODO
+
+                else:
+                    mCouponManagement = CouponManagement(weichat_id=openId,
+                                                coupon_name='临时消费卡券',
+                                                coupon_id=obj['id'],
                                                 price=str(discount),
                                                 start_date=datetime.datetime.strptime(str(datetime.date.today()),
                                                                                             "%Y-%m-%d"),
@@ -521,25 +620,27 @@
                                                 seller_name=obj['seller'],
                                                 monetary=obj['price'],
                                                 )
-                mCouponManagement.save()
-                mUser = User.objects(wechat_openId=openId).first()
-                if (mUser != None):
-                    mUserCouponModel = UserCouponModel(wechat_openId=openId,
-                                                       coupon_id=openId,
+                    mCouponManagement.save()
+                    mUser = User.objects(wechat_openId=openId).first()
+                    if (mUser != None):
+                        mUserCouponModel = UserCouponModel(wechat_openId=openId,
+                                                       coupon_id=obj['id'],
                                                        park_name=str(mPropertyCompany.park_name),
                                                        coupon_name=str(mCouponManagement.coupon_name),
+                                                       coupon_type="1",
                                                        coupon_status=COUPON_STATUS_VAILD,
                                                        coupon_price=mCouponManagement.price,
                                                        coupon_validity=str(mCouponManagement.valid_date),
                                                        receive_count=1,
                                                        total_count=1,
                                                        coupon_start=str(mCouponManagement.start_date))
-                    mUserCouponModel.save()
+                        mUserCouponModel.save()
 
-                    mUser.coupon_list.append(mUserCouponModel)
-                    mUser.update(wechat_openId=openId, coupon_list=mUser.coupon_list)
+                        mUser.coupon_list.append(mUserCouponModel)
+                        mUser.update(wechat_openId=openId, coupon_list=mUser.coupon_list)
         return self.getUserCoupon(openId)
 
+
 class UserParkHistroy:
     # 获取用户支付订单历史，只返回已经支付完成的订单
     def getUserParkHistroy(self, openId):
Index: parkserver/app/WechatTools.py
===================================================================
--- parkserver/app/WechatTools.py	(revision 328)
+++ parkserver/app/WechatTools.py	(working copy)
@@ -346,21 +346,25 @@
         # 处理优惠券问题
         if (len(couponId) <= 0):
             return False
-
-        mUserCouponModel = UserCouponModel.objects(coupon_id=couponId, coupon_status=COUPON_STATUS_VAILD,
+        # TODO
+        CouponIds = couponId.split(";")
+        for _couponId in CouponIds:
+            if _couponId != None:
+                mUserCouponModel = UserCouponModel.objects(coupon_id=_couponId, coupon_status=COUPON_STATUS_VAILD,
                                                    wechat_openId=openId).first()
-        if (mUserCouponModel != None):
-            if (mUserCouponModel.receive_count > 0 and mUserCouponModel.receive_count == 1):
-                mUserCouponModel.update(coupon_id=couponId, coupon_status=COUPON_STATUS_USED, receive_count=0)
-            elif (mUserCouponModel.receive_count > 0 and mUserCouponModel.receive_count > 1):
-                mUserCouponModel.receive_count = mUserCouponModel.receive_count - 1
-                mUserCouponModel.update(coupon_id=couponId, receive_count=mUserCouponModel.receive_count)
+                if (mUserCouponModel != None):
+                    if (mUserCouponModel.receive_count > 0 and mUserCouponModel.receive_count == 1):
+                        mUserCouponModel.update(coupon_id=_couponId, coupon_status=COUPON_STATUS_USED, receive_count=0)
+                    elif (mUserCouponModel.receive_count > 0 and mUserCouponModel.receive_count > 1):
+                        mUserCouponModel.receive_count = mUserCouponModel.receive_count - 1
+                        mUserCouponModel.update(coupon_id=_couponId, receive_count=mUserCouponModel.receive_count)
 
             # 提交已经使用掉的卡券数量
-            mCouponManagement = CouponManagement.objects(coupon_id=couponId).first()
-            if (mCouponManagement != None):
-                mCouponManagement.used_amount = mCouponManagement.used_amount + 1
-                mCouponManagement.update(coupon_id=couponId, used_amount=mCouponManagement.used_amount)
+                    mCouponManagement = CouponManagement.objects(coupon_id=_couponId).first()
+                    if (mCouponManagement != None):
+                        mCouponManagement.used_amount = mCouponManagement.used_amount + 1
+                        mCouponManagement.update(coupon_id=_couponId, used_amount=mCouponManagement.used_amount)
+        # TODO
 
         return True
 
Index: parkserver/app/models.py
===================================================================
--- parkserver/app/models.py	(revision 328)
+++ parkserver/app/models.py	(working copy)
@@ -121,7 +121,7 @@
     isPaid = db.BooleanField(default=False) # 是否支付
     paymentNr = db.StringField(max_length=50)  # 缴费次数
     isInvoice = db.BooleanField(default=False)  # 发票状态
-    chooseCouponId = db.StringField(max_length=100) # 优惠券编号
+    chooseCouponId = db.StringField(max_length=255) # 优惠券编号
     park_id = db.StringField(max_length=20)  # 停车场编号
     park_name = db.StringField(max_length=50)   # 停车场名称
     company_name = db.StringField(max_length=255)   # 物业公司
@@ -143,6 +143,7 @@
     coupon_status = db.IntField()
     coupon_price = db.FloatField()
     coupon_validity = db.StringField(max_length=100)
+    coupon_type = db.StringField(max_length=255, default=0)  # TODO
     receive_count = db.IntField(default=1)
     total_count = db.IntField(default=0)
     coupon_start = db.StringField(max_length=100)
@@ -179,6 +180,7 @@
 
 # 卡券管理model
 class CouponManagement(db.Document):
+    weichat_id = db.StringField(max_length=100)
     coupon_name = db.StringField(max_length=100, required=True)
     coupon_id = db.StringField(max_length=100, required=True)
     price = db.StringField(max_length=20, default='1.00', required=True)
@@ -211,6 +213,36 @@
     def __unicode__(self):
         return str(self.coupon_name)
 
+# 消费记录model
+class ConsumptionCoupon(db.Document):
+    weichat_id = db.StringField(max_length=100)
+    coupon_name = db.StringField(max_length=100, required=True)
+    coupon_id = db.StringField(max_length=100, required=True)
+    price = db.StringField(max_length=20, default='1.00', required=True)
+    receive_date = db.DateTimeField(default=datetime.datetime.strptime(str(datetime.date.today()), '%Y-%m-%d'))
+    receive_close_date = db.DateTimeField(
+            default=datetime.datetime.strptime(str(datetime.date.today()), '%Y-%m-%d') + datetime.timedelta(days=+7,
+                                                                                                            hours=+23,
+                                                                                                            minutes=+59,
+                                                                                                            seconds=+59))
+    valid_date = db.DateTimeField(
+        default=datetime.datetime.strptime(str(datetime.date.today()), '%Y-%m-%d') + datetime.timedelta(days=+7,
+                                                                                                        hours=+23,
+                                                                                                        minutes=+59,
+                                                                                                        seconds=+59))
+    coupon_type = db.StringField(max_length=255, default=0)
+    start_date = db.DateTimeField(default=datetime.datetime.strptime(str(datetime.date.today()), "%Y-%m-%d"))
+    receive_count = db.StringField(max_length=20, default='1')
+    amount = db.StringField(max_length=20, default='1')
+    received_amount = db.IntField(default=0)
+    used_amount = db.IntField(default=0)
+    parks = db.StringField()
+    park_id = db.StringField(max_length=255)
+    coupon_status = db.StringField(max_length=20)
+    company_name = db.StringField(max_length=255)
+    seller_name = db.StringField(max_length=255)
+    monetary = db.StringField(max_length=20, default='0.00')
+
 # 发票管理model
 class InvoiceManagement(db.Document):
     company_name = db.StringField(max_length=255)
@@ -235,6 +267,7 @@
     random_min = db.StringField(max_length=10, default=0, required=True)  # 随机最小折扣金额
     random_max = db.StringField(max_length=10, default=0, required=True)  # 随机最大折扣金额
     reuse_times = db.StringField(max_length=10, default=1, required=True)  # 当天使用次数
+    discount_rulers = db.DictField(default={200:1,400:3,600:6})  # 消费折扣规则 TODO
 
     def __unicode__(self):
         return str(self.parks)
@@ -268,7 +301,7 @@
     Time = db.IntField(default=0)
     QuitTime = db.StringField(max_length=50)
     seq = db.StringField(max_length=50)
-    chooseCouponId = db.StringField(max_length=50)
+    chooseCouponId = db.StringField(max_length=255)
     payway = db.StringField(max_length=50)
 
 
Index: parkserver/app/route.py
===================================================================
--- parkserver/app/route.py	(revision 328)
+++ parkserver/app/route.py	(working copy)
@@ -203,13 +203,13 @@
         thirdOpenId = request.form.get('thirdOpenId')
         logging.debug('wechatPay:{0} {1} {2} {3} {4} {5} {6}'.format(Seq, Ticket, lpn, parkId, payway, Price, ActualPrice))
         finish = mMyUserOrder.saveUserOrder(Ticket, nickName, openId, Seq, Time, Entry, PaymentNr, Discount, Price,
-                                            QuitTime, chooseCouponId, ActualPrice, thirdOpenId, parkId, lpn, payway)
+                                            QuitTime, chooseCouponId, ActualPrice, thirdOpenId, parkId, lpn, payway)  # TODO
 
         if (finish == True):
             respData = mWechatTools.getWechatPayInfo(str(int(float(ActualPrice) * 100)), openId, str(ip), Ticket, Time,
-                                                     QuitTime, Seq, chooseCouponId, appid, lpn, payway, parkId)
+                                                     QuitTime, Seq, chooseCouponId, appid, lpn, payway, parkId)  # TODO
         else:
-            respData = mMyUserOrder.paySuccessWithZero(openId, Ticket, chooseCouponId, Seq, Price, parkId, lpn, payway)
+            respData = mMyUserOrder.paySuccessWithZero(openId, Ticket, chooseCouponId, Seq, Price, parkId, lpn, payway)  #TODO
     except Exception as e:
         logging.exception(e)
     return setRespData(respData)
@@ -426,9 +426,9 @@
         logging.debug(sign)
         if cytelSign == sign:
             # 规则计算折扣
-            discount = 10.0
+            discount = 10.0  # TODO
             # 生成卡券
-            respData = mUserCoupon.exchangeUserCoupon(openId, obj, discount)
+            respData = mUserCoupon.exchangeUserCoupon(openId, obj, price)  # TODO
         else:
             respData = {'code': 0, 'msg': '二维码验签失败'}
     except Exception as e:
Index: parkserver/app/views.py
===================================================================
--- parkserver/app/views.py	(revision 328)
+++ parkserver/app/views.py	(working copy)
@@ -1821,6 +1821,7 @@
         self.column_default_sort = ("parks", True)
         self.column_list = ('week_day',
                             'discount_type',
+                            'discount_rulers',  # TODO
                             'fix_discount',
                             'random_min',
                             'random_max',
@@ -1829,6 +1830,7 @@
                             )
         self.column_labels = dict(week_day='周期',
                                   discount_type='折扣类型',
+                                  discount_rulers='满减折扣规则',  # TODO
                                   fix_discount='固定折扣金额',
                                   random_min='随机最小折扣金额',
                                   random_max='随机最大折扣金额',
@@ -1848,19 +1850,23 @@
                                       )
         discount_type_select = SelectField('折扣类型',
                                            choices=[('0', '固定折扣'),
-                                                    ('1', '随机折扣')],
+                                                    ('1', '随机折扣'),
+                                                    ('2', '满减折扣')],  # TODO
                                            validators=[DataRequired()]
                                            )
         park_select = SelectMultipleField('停车场',
                                           choices=[], validators=[DataRequired()]
                                           )
+        #discount_rulers_details = StringField('满减折扣',"购满:" + '100'+'减:'+ '1')  # TODO
         self.form_extra_fields = {
             'week_day_select': week_day_select,
             'discount_type_select': discount_type_select,
-            'park_select': park_select
+            'park_select': park_select,
+            #'discount_rulers_details': discount_rulers_details  # TODO
         }
         self.form_args = dict(week_day=dict(label='周期'),
                               discount_type=dict(label='折扣类型'),
+                              discount_rulers=dict(label='满减折扣规则', validators=[DataRequired()]),  # TODO
                               fix_discount=dict(label='固定折扣金额', validators=[DataRequired(),
                                                         Regexp(regex=r'^[1-9]\d*$|^0$', message='请输入正整数')]),
                               random_min=dict(label='随机最小折扣金额', validators=[DataRequired(),
@@ -1874,7 +1880,8 @@
         # self.column_filters = ('park_id')
         self.column_searchable_list = ('discount_type', 'parks')
         self.form_create_rules = ('week_day_select',
-                                  'discount_type_select',
+                                  'discount_type_select', # TODO
+                                  'discount_rulers',
                                   'fix_discount',
                                   'random_min',
                                   'random_max',
@@ -1884,6 +1891,7 @@
         self.form_edit_rules = (
             'week_day_select',
             'discount_type_select',
+            'discount_rulers',  # TODO
             'fix_discount',
             'random_min',
             'random_max',
@@ -1929,6 +1937,7 @@
         self.form_edit_rules = (
             'week_day_select',
             'discount_type_select',
+            'discount_rulers',  # TODO
             'fix_discount',
             'random_min',
             'random_max',
@@ -1978,6 +1987,7 @@
         if user.has_role('SuperAdmin'):
             self.form_create_rules = ('week_day_select',
                                       'discount_type_select',
+                                      'discount_rulers',  # TODO
                                       'fix_discount',
                                       'random_min',
                                       'random_max',
@@ -1987,6 +1997,7 @@
         elif user.has_role('PropertyAdmin'):
             self.form_create_rules = ('week_day_select',
                                       'discount_type_select',
+                                      'discount_rulers',  # TODO
                                       'fix_discount',
                                       'random_min',
                                       'random_max',
@@ -1996,6 +2007,7 @@
         elif user.has_role('ParkAdmin'):
             self.form_create_rules = ('week_day_select',
                                       'discount_type_select',
+                                      'discount_rulers',  # TODO
                                       'fix_discount',
                                       'random_min',
                                       'random_max',
